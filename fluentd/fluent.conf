# Pipeline Fluentd : collecte des logs API → Postgres via FastAPI

# Source : reçoit les logs Docker via le log driver fluentd
<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

# Filtre : parse le JSON des logs structurés de l'API
<filter docker.**>
  @type parser
  key_name log
  reserve_data true
  <parse>
    @type json
  </parse>
</filter>

# Output : forward vers l'endpoint d'ingestion de l'API
<match docker.**>
  @type http
  endpoint http://api:8000/internal/logs
  content_type application/json
  <format>
    @type json
  </format>
  <buffer>
    @type memory
    flush_interval 5s
    chunk_limit_size 1m
    retry_max_times 3
  </buffer>
</match>
